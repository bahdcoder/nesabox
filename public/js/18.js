(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"1ki8":function(t,e,i){"use strict";i.r(e);var n=i("j5TT"),s=(i("p77/"),i("c3yf"),i("AvDn"),{components:{codemirror:n.codemirror},data:function(){return{fetchingEcosystemFile:!1,fetchingNginxConfigFile:!1,updatingEcosystemFile:!1,updatingNginxConfigFile:!1,ecosystemFile:"",nginxConfigFile:"",fetchingCustomFile:!1,customFileFetched:!1,fileContent:"",updatingCustomFile:!1,codeMirrorOptions:{theme:"lucario",tabSize:4,line:!0,mode:"shell",lineNumbers:!0}}},computed:{site:function(){return this.$root.sites[this.$route.params.site]||{}},server:function(){return this.$root.servers[this.$route.params.server]||{}},serverId:function(){return this.$route.params.server},siteId:function(){return this.$route.params.site}},methods:{fetchPm2File:function(){var t=this;this.fetchingEcosystemFile=!0,axios.get("/api/servers/".concat(this.serverId,"/sites/").concat(this.siteId,"/ecosystem-file")).then((function(e){var i=e.data;t.ecosystemFile=i})).catch((function(){t.$root.flashMessage("Failed to fetch the ecosystem file.","error")})).finally((function(){t.fetchingEcosystemFile=!1}))},fetchNginxConfigFile:function(){var t=this;this.fetchingNginxConfigFile=!0,axios.get("/api/servers/".concat(this.serverId,"/sites/").concat(this.siteId,"/nginx-config")).then((function(e){var i=e.data;t.nginxConfigFile=i})).catch((function(){t.$root.flashMessage("Failed to fetch the nginx configuration file.","error")})).finally((function(){t.fetchingNginxConfigFile=!1}))},updateNginxConfigFile:function(){var t=this;this.updatingNginxConfigFile=!0,axios.post("/api/servers/".concat(this.serverId,"/sites/").concat(this.siteId,"/nginx-config"),{nginxConfig:this.nginxConfigFile}).then((function(){t.$root.flashMessage("Nginx configuration file updated."),t.nginxConfigFile=""})).catch((function(){t.$root.flashMessage("Failed to update the nginx configuration file.","error")})).finally((function(){t.updatingNginxConfigFile=!1}))},updatePm2File:function(){var t=this;this.updatingEcosystemFile=!0,axios.post("/api/servers/".concat(this.serverId,"/sites/").concat(this.siteId,"/ecosystem-file"),{ecosystemFile:this.ecosystemFile}).then((function(){t.$root.flashMessage("Ecosystem file updated."),t.ecosystemFile=""})).catch((function(){t.$root.flashMessage("Failed to update the ecosystem file.","error")})).finally((function(){t.updatingEcosystemFile=!1}))},siteMounted:function(){this.form={path:"/home/nesa/".concat(this.site.name,"/.env")}},fetchFile:function(){var t=this;this.fetchingCustomFile=!0,axios.post("/api/sites/".concat(this.site.id,"/get-file-contents"),this.form).then((function(e){var i=e.data;t.customFileFetched=!0,t.fileContent=i})).catch((function(e){var i=e.response;t.$root.flashMessage(i.data.message||"Failed to fetch this file.")})).finally((function(){t.fetchingCustomFile=!1}))},updateFile:function(){var t=this;this.updatingCustomFile=!0,axios.post("/api/sites/".concat(this.site.id,"/update-file-contents"),{fileContent:this.fileContent,path:this.form.path}).then((function(e){e.data;t.customFileFetched=!1,t.fileContent="",t.$root.flashMessage("File content updated.")})).catch((function(e){var i=e.response;t.$root.flashMessage(i.data||"Failed to update this file.")})).finally((function(){t.updatingCustomFile=!1}))}}}),o=i("KHd+"),a=Object(o.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("site-layout",{on:{mounted:t.siteMounted}},[i("template",{slot:"content"},[i("flash"),t._v(" "),"nodejs"===t.site.type&&"load_balancer"!==t.server.type?i("card",{staticClass:"mb-6",attrs:{title:"PM2 Ecosystem file"}},[i("info",[t._v("\n                This is the PM2 configuration for your site. Here you can\n                define environment secrets. The content of this file is\n                never saved on our servers.\n            ")]),t._v(" "),t.ecosystemFile?t._e():i("v-button",{staticClass:"mt-4",attrs:{loading:t.fetchingEcosystemFile,label:"Edit Ecosystem file"},on:{click:t.fetchPm2File}}),t._v(" "),t.ecosystemFile?i("codemirror",{staticClass:"my-4",attrs:{options:t.codeMirrorOptions},model:{value:t.ecosystemFile,callback:function(e){t.ecosystemFile=e},expression:"ecosystemFile"}}):t._e(),t._v(" "),t.ecosystemFile?i("v-button",{staticClass:"mt-4",attrs:{loading:t.updatingEcosystemFile,label:"Update Ecosystem file"},on:{click:t.updatePm2File}}):t._e()],1):t._e(),t._v(" "),i("card",{staticClass:"mb-5",attrs:{title:"Nginx configuration file"}},[i("info",[t._v("\n                This is the Nginx configuration for your site.\n                "),"nodejs"===t.site.type?i("span",{staticClass:"ml-1"},[t._v("Make sure the proxy port here matches the port your\n                    application is running on.")]):t._e()]),t._v(" "),t.nginxConfigFile?t._e():i("v-button",{staticClass:"mt-4",attrs:{loading:t.fetchingNginxConfigFile,label:"Edit Nginx Configuration"},on:{click:t.fetchNginxConfigFile}}),t._v(" "),t.nginxConfigFile?i("codemirror",{staticClass:"my-4",attrs:{options:t.codeMirrorOptions},model:{value:t.nginxConfigFile,callback:function(e){t.nginxConfigFile=e},expression:"nginxConfigFile"}}):t._e(),t._v(" "),t.nginxConfigFile?i("v-button",{staticClass:"mt-4",attrs:{loading:t.updatingNginxConfigFile,label:"Update Nginx file"},on:{click:t.updateNginxConfigFile}}):t._e()],1),t._v(" "),"load_balancer"!==t.server.type?i("card",{attrs:{title:"Custom file"}},[t.customFileFetched?i("div",{staticClass:"w-full"},[i("text-input",{staticClass:"mb-3",attrs:{name:"path",value:t.form.path,readonly:!0}}),t._v(" "),i("codemirror",{attrs:{options:t.codeMirrorOptions},model:{value:t.fileContent,callback:function(e){t.fileContent=e},expression:"fileContent"}}),t._v(" "),i("v-button",{staticClass:"mt-3",attrs:{label:"Update file",loading:t.updatingCustomFile},on:{click:t.updateFile}})],1):i("form",{on:{submit:function(e){return e.preventDefault(),t.fetchFile(e)}}},[i("text-input",{attrs:{name:"path",label:"Path to file",help:"Here you can edit a custom file on this site. Make sure this file is not version controlled, because editing it might break deployments."},model:{value:t.form.path,callback:function(e){t.$set(t.form,"path",e)},expression:"form.path"}}),t._v(" "),i("v-button",{staticClass:"mt-3",attrs:{label:"Fetch file",type:"submit",loading:t.fetchingCustomFile}})],1)]):t._e()],1)],2)}),[],!1,null,null,null);e.default=a.exports}}]);