(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{JLvP:function(e,t,o){"use strict";o.r(t);function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var a={mounted:function(){this.form={command:"",user:"nesa",cron1:"*",cron2:"*",cron3:"*",cron4:"*",cron5:"*",frequency:"everyMinute"},this.initializeForm("/api/servers/".concat(this.$route.params.server,"/cron-jobs"))},data:function(){return{logs:"",deletingJob:!1,selectedJob:null,showLogsModal:!1,showDeleteModal:!1,tableHeaders:[{label:"Cron",value:"cron"},{label:"User",value:"user"},{label:"Status",value:"status"},{label:"Command",value:"command"},{label:"",value:"logs"},{label:"",value:"delete"}],frequencies:[{label:"Every Minute",value:"everyMinute"},{label:"Every Five Minutes",value:"everyFiveMinutes"},{label:"Every Ten Minutes",value:"everyTenMinutes"},{label:"Hourly",value:"hourly"},{label:"Nightly",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Custom cron",value:"custom"}]}},computed:{server:function(){return this.$root.servers[this.$route.params.server]||{}},jobs:function(){return this.server.jobs||[]}},methods:{hideLogs:function(){this.selectedJob=null,this.showLogsModal=!1},serverMounted:function(){"load_balancer"===this.server.type&&this.$router.push("/servers/".concat(this.server.id))},showConfirmDeleteModal:function(e){this.showDeleteModal=!0,this.selectedJob=e},showLogs:function(e){var t=this;this.showLogsModal=!0,axios.post("/api/servers/".concat(this.server.id,"/cron-jobs/").concat(e.id,"/log")).then((function(o){var r=o.data;t.logs=r,t.selectedJob=e})).catch((function(e){var o=e.response;t.showLogsModal=!1,t.$root.flashMessage(o.data.message||"Failed fetching logs for job.","error")}))},submit:function(){var e=this;"custom"===this.form.frequency&&(this.form=s({},this.form,{cron:"".concat(this.form.cron1).concat(this.form.cron2).concat(this.form.cron3).concat(this.form.cron4).concat(this.form.cron5)})),this.submitForm().then((function(t){e.$root.servers=s({},e.$root.servers,n({},t.id,t)),e.form={command:"",user:"",frequency:"everyMinute"},e.$root.flashMessage("Schedule job added.")}))},deleteJob:function(){var e=this;this.deletingJob=!0,axios.delete("/api/servers/".concat(this.server.id,"/cron-jobs/").concat(this.selectedJob.id)).then((function(t){var o=t.data;e.$root.servers=s({},e.$root.servers,n({},o.id,o)),e.$root.flashMessage("Cron job has been deleted.")})).catch((function(t){var o=t.response;e.$root.flashMessage(o.data.message||"Failed deleting job.","error")})).finally((function(){e.deletingJob=!1,e.selectedJob=null,e.showDeleteModal=!1}))},closeConfirmDeleteJob:function(){this.deletingJob=!1,this.showDeleteModal=!1,this.selectedJob=null}}},l=o("KHd+"),c=Object(l.a)(a,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("server-layout",{on:{mounted:e.serverMounted}},[o("template",{slot:"content"},[o("flash"),e._v(" "),o("confirm-modal",{attrs:{open:e.showDeleteModal,confirming:e.deletingJob,confirmHeading:"Delete scheduled job",confirmText:"Are you sure you want to delete the scheduled job "+(e.selectedJob&&e.selectedJob.command)+" ?"},on:{confirm:e.deleteJob,close:e.closeConfirmDeleteJob}}),e._v(" "),o("modal",{attrs:{open:e.showLogsModal}},[o("div",{staticClass:"p-6"},[e.selectedJob?o("div",[o("h2",{staticClass:"text-lg mb-3 text-gray-800"},[e._v("\n                        Job logs ("+e._s(e.selectedJob&&e.selectedJob.slug)+")\n                    ")]),e._v(" "),o("v-codemirror",{attrs:{value:e.logs}})],1):o("div",{staticClass:"w-full h-12 flex justify-center items-center rounded",staticStyle:{background:"#2b3e50"}},[o("pulse")],1),e._v(" "),o("div",{staticClass:"w-full md:flex md:justify-end"},[o("v-trans-button",{staticClass:"mt-4",attrs:{label:"Close"},on:{click:e.hideLogs}})],1)])]),e._v(" "),o("card",{staticClass:"mb-6",attrs:{title:"New Scheduled Job"}},[o("form",{on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[o("text-input",{attrs:{name:"command",label:"Command",errors:e.formErrors.command},model:{value:e.form.command,callback:function(t){e.$set(e.form,"command",t)},expression:"form.command"}}),e._v(" "),o("text-input",{staticClass:"mt-5",attrs:{name:"user",label:"User",errors:e.formErrors.user,help:"This is the user the cron job would be executed with."},model:{value:e.form.user,callback:function(t){e.$set(e.form,"user",t)},expression:"form.user"}}),e._v(" "),o("div",{staticClass:"mt-4"},[o("v-radio",{attrs:{id:"frequency",label:"Frequency",options:e.frequencies,errors:e.formErrors.frequency},model:{value:e.form.frequency,callback:function(t){e.$set(e.form,"frequency",t)},expression:"form.frequency"}}),e._v(" "),o("a",{attrs:{target:"_blank",href:"https://crontab.guru/"}},["custom"===e.form.frequency?o("info",{staticClass:"mt-4"},[o("div",[e._v("\n                                You can generate a valid cron expression\n                                using\n                                "),o("span",{staticClass:"ml-1 font-semibold"},[e._v("this tool")])])]):e._e()],1),e._v(" "),"custom"===e.form.frequency?o("div",{staticClass:"grid grid-cols-5 gap-4 mt-3"},[o("text-input",{staticClass:"text-center",attrs:{name:"cron-1"},model:{value:e.form.cron1,callback:function(t){e.$set(e.form,"cron1",t)},expression:"form.cron1"}}),e._v(" "),o("text-input",{staticClass:"text-center",attrs:{name:"cron-2"},model:{value:e.form.cron2,callback:function(t){e.$set(e.form,"cron2",t)},expression:"form.cron2"}}),e._v(" "),o("text-input",{staticClass:"text-center",attrs:{name:"cron-3"},model:{value:e.form.cron3,callback:function(t){e.$set(e.form,"cron3",t)},expression:"form.cron3"}}),e._v(" "),o("text-input",{staticClass:"text-center",attrs:{name:"cron-4"},model:{value:e.form.cron4,callback:function(t){e.$set(e.form,"cron4",t)},expression:"form.cron4"}}),e._v(" "),o("text-input",{staticClass:"text-center",attrs:{name:"cron-5"},model:{value:e.form.cron5,callback:function(t){e.$set(e.form,"cron5",t)},expression:"form.cron5"}})],1):e._e()],1),e._v(" "),o("v-button",{staticClass:"mt-5",attrs:{type:"submit",label:"Schedule Job",loading:e.submitting}})],1)]),e._v(" "),o("card",{attrs:{title:"Scheduled jobs",table:!0,rowsCount:e.jobs.length,emptyTableMessage:"No scheduled jobs running on this server yet."}},[o("v-table",{attrs:{headers:e.tableHeaders,rows:e.jobs},scopedSlots:e._u([{key:"row",fn:function(t){var r=t.row,s=t.header;return["status"===s.value?o("table-status",{attrs:{status:r.status}}):e._e(),e._v(" "),"delete"===s.value?o("delete-button",{on:{click:function(t){return e.showConfirmDeleteModal(r)}}}):e._e(),e._v(" "),"logs"===s.value?o("button",{staticClass:"border-2 border-gray-500 p-1 rounded hover:bg-gray-100 shadow",on:{click:function(t){return e.showLogs(r)}}},[o("svg",{attrs:{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"20",height:"20"}},[o("path",{attrs:{d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}})])]):e._e(),e._v(" "),["slug","user","cron","frequency"].includes(s.value)?o("span",{staticClass:"text-gray-700 text-sm"},[e._v("\n                        "+e._s(r[s.value])+"\n                    ")]):e._e(),e._v(" "),"command"===s.value?o("code",{staticClass:"text-red-400"},[e._v("\n                        "+e._s(r.command)+"\n                    ")]):e._e()]}}])})],1)],1)],2)}),[],!1,null,null,null);t.default=c.exports}}]);